/*! media-credit media-credit-tinymce.js 2020-04-18 12:02:48 AM */

tinymce.PluginManager.add("mediacredit",function(x){"use strict";var m,M,a,p,n,e=tinymce.each,g=tinymce.trim,t=tinymce.Env.iOS;function i(e){return!(!x.dom.getAttrib(e,"data-mce-placeholder")&&!x.dom.getAttrib(e,"data-mce-object"))}function r(e){var t=x.$(e).parents("[contenteditable]");return t&&"false"===t.attr("contenteditable")}function d(e){return l(e.replace(/(?:<p>)?\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\](?:<\/p>)?/g,function(e,t,a){var n,i,r,d,o,c;return(n=t.match(/id=['"]([^'"]*)['"] ?/))&&(t=t.replace(n[0],"")),(i=t.match(/align=['"]([^'"]*)['"] ?/))&&(t=t.replace(i[0],"")),(r=t.match(/class=['"]([^'"]*)['"] ?/))&&(t=t.replace(r[0],"")),(c=t.match(/width=['"]([0-9]*)['"] ?/))&&(t=t.replace(c[0],"")),o=l(o=(o=null!==(o=(a=g(a)).match(/((?:\[media-credit[^\]]+\]\s*)(?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?(?:\s*\[\/media-credit\])?)([\s\S]*)/i))?o:a.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i))&&o[2]?(d=g(o[2]),g(o[1])):(d=g(t).replace(/caption=['"]/,"").replace(/['"]$/,""),a),!1),n=n&&n[1]?n[1].replace(/[<>&]+/g,""):"",i=i&&i[1]?i[1]:"alignnone",r=r&&r[1]?" "+r[1].replace(/[<>&]+/g,""):"",!c&&o&&(c=o.match(/width=['"]([0-9]*)['"]/)),c&&c[1]&&(c=c[1]),c&&d?(c=parseInt(c,10),x.getParam("wpeditimage_html5_captions")||(c+=10),'<div class="mceTemp"><dl id="'+n+'" class="wp-caption '+i+r+'" style="width: '+c+'px"><dt class="wp-caption-dt">'+o+'</dt><dd class="wp-caption-dd">'+d+"</dd></dl></div>"):a}),!0)}function l(e,d){return wp.shortcode.replace("media-credit",e,function(e){var t,a,n,i,r;return(n=(a=g(e.content)).match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i))&&n[1]&&(n=g(n[1])),(t=e.attrs.named).id=t.id||"",t.name=t.name||"",t.align=t.align||"alignnone",t.link=t.link||"",t.nofollow=t.nofollow||"",!t.width&&n&&(t.width=wp.html.attrs(n).width),t.width=parseInt(t.width,10),t.width&&(t.name||t.id)?(x.getParam("wpeditimage_html5_captions")||(t.width+=10),i=(i=t.name?t.name:mundschenk.mediaCredit.id[t.id]+mundschenk.mediaCredit.options.separator+mundschenk.mediaCredit.options.organization).replace(/<[^>]+>(.*)<\/[^>]+>/g,"$1"),r=n+wp.html.string({tag:"span",content:i,attrs:{class:"mceMediaCreditTemp mceNonEditable","data-media-credit-author-id":_.escape(t.id),"data-media-credit-text":_.escape(t.name),"data-media-credit-align":_.escape(t.align),"data-media-credit-link":_.escape(t.link),"data-media-credit-nofollow":_.escape(t.nofollow)}}),d&&(r=wp.html.string({tag:"div",content:r,attrs:{class:"mceMediaCreditOuterTemp "+_.escape(t.align),style:"width: "+t.width+"px"}})),r):a})}function o(e){return c(e.replace(/(?:<div [^>]+mceTemp[^>]+>)?\s*(<dl [^>]+wp-caption[^>]+>[\s\S]+?<\/dl>)\s*(?:<\/div>)?/g,function(e,t){var a="";return-1===t.indexOf("<img ")||-1!==t.indexOf("</p>")?t.replace(/<d[ldt]( [^>]+)?>/g,"").replace(/<\/d[ldt]>/g,""):(-1===(a=t.replace(/\s*<dl ([^>]+)>\s*<dt [^>]+>([\s\S]+?)<\/dt>\s*<dd [^>]+>([\s\S]*?)<\/dd>\s*<\/dl>\s*/gi,function(e,t,a,n){var i,r,d,o;return o=(o=a.match(/width="([0-9]*)"/))&&o[1]?o[1]:"",d=(r=(r=t.match(/class="([^"]*)"/))&&r[1]?r[1]:"").match(/align[a-z]+/i)||"alignnone",o&&n?(i=(i=t.match(/id="([^"]*)"/))&&i[1]?i[1]:"",(r=r.replace(/wp-caption ?|align[a-z]+ ?/gi,""))&&(r=' class="'+r+'"'),n=(n=n.replace(/\r\n|\r/g,"\n").replace(/<[a-zA-Z0-9]+( [^<>]+)?>/g,function(e){return e.replace(/[\r\n\t]+/," ")})).replace(/\s*\n\s*/g,"<br />"),'[caption id="'+i+'" align="'+d+'" width="'+o+'"'+r+"]"+(a=c(a,!1))+" "+n+"[/caption]"):("alignnone"!==d[0]&&(a=a.replace(/><img/,' class="'+d[0]+'"><img')),a)})).indexOf("[caption")&&(a=t.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2")),a)}),!0)}function c(e,t){var a=t?/<div class="mceMediaCreditOuterTemp[^"]*"[^>]*>((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)<span class="mceMediaCreditTemp[^"]*" ([^>]*)>([\s\S]+?)<\/span><\/div>/g:/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)<span class="mceMediaCreditTemp[^"]*" ([^>]*)>([\s\S]+?)<\/span>/g;return e.replace(a,function(e,t,a,n){var i,r,d;return-1===t.indexOf("<img ")?"<p>"+n+"</p>":(i=wp.html.attrs(a),(r={tag:"media-credit",attrs:{id:_.unescape(i["data-media-credit-author-id"]),name:_.unescape(i["data-media-credit-text"]),link:_.unescape(i["data-media-credit-link"]),nofollow:"true"===_.unescape(i["data-media-credit-nofollow"]),align:_.unescape(i["data-media-credit-align"]),width:wp.html.attrs(t).width},content:t,type:"closed"}).attrs.id?r.attrs.name=void 0:r.attrs.id=void 0,_.each(Object.keys(r.attrs),function(e){r.attrs[e]||delete r.attrs[e]}),r.attrs.width&&(r.attrs.name||r.attrs.id)?(0!==(d=wp.shortcode.string(r)).indexOf("[media-credit")&&(d=t.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2")),d):t)})}function P(e){return e&&!!(e.textContent||e.innerText).replace(/\ufeff/g,"")}function s(e){var t=x.dom.getParent(e,"div.mceTemp")||x.dom.getParent(e,"div.mceMediaCreditOuterTemp");t||"IMG"!==e.nodeName||(t=x.dom.getParent(e,"a")),t?(t.nextSibling?x.selection.select(t.nextSibling):t.previousSibling?x.selection.select(t.previousSibling):x.selection.select(t.parentNode),x.selection.collapse(!0),x.dom.remove(t)):x.dom.remove(e),x.nodeChanged(),x.undoManager.add()}return x.addButton("wp_img_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){s(x.selection.getNode())}}),x.addButton("wp_img_edit",{tooltip:"Edit|button",icon:"dashicon dashicons-edit",onclick:function(){!function(e){var t,a,n,i;if("undefined"==typeof wp||!wp.media)return x.execCommand("mceImage");n=function(e){var t,a,n,i,r,d,o,c,l,s=[],m=x.dom,p=/^\d+$/;(n={attachment_id:!1,size:"custom",caption:"",align:"none",extraClasses:"",link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:"",mediaCreditText:"",mediaCreditAuthorID:"",mediaCreditLink:"",mediaCreditNoFollow:""}).url=m.getAttrib(e,"src"),n.alt=m.getAttrib(e,"alt"),n.title=m.getAttrib(e,"title"),o=m.getAttrib(e,"width"),c=m.getAttrib(e,"height"),(!p.test(o)||parseInt(o,10)<1)&&(o=e.naturalWidth||e.width);(!p.test(c)||parseInt(c,10)<1)&&(c=e.naturalHeight||e.height);n.customWidth=n.width=o,n.customHeight=n.height=c,t=tinymce.explode(e.className," "),a=[],tinymce.each(t,function(e){/^wp-image/.test(e)?n.attachment_id=parseInt(e.replace("wp-image-",""),10):/^align/.test(e)?n.align=e.replace("align",""):/^size/.test(e)?n.size=e.replace("size-",""):a.push(e)}),n.extraClasses=a.join(" "),n.captionClassName=s.join(" "),(i=m.getParents(e,".wp-caption")).length&&(i=i[0],t=i.className.split(" "),tinymce.each(t,function(e){/^align/.test(e)?n.align=e.replace("align",""):e&&"wp-caption"!==e&&s.push(e)}),(r=m.select("dd.wp-caption-dd",i)).length&&(r=r[0],n.caption=x.serializer.serialize(r).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,"")));e.parentNode&&"A"===e.parentNode.nodeName&&(d=e.parentNode,n.linkUrl=m.getAttrib(d,"href"),n.linkTargetBlank="_blank"===m.getAttrib(d,"target"),n.linkRel=m.getAttrib(d,"rel"),n.linkClassName=d.className);l=d?m.getNext(d,".mceMediaCreditTemp"):m.getNext(e,".mceMediaCreditTemp");l&&(n.align=n.align&&"none"!==n.align?n.align:m.getAttrib(l,"data-media-credit-align","").replace("align",""),n.mediaCreditText=m.getAttrib(l,"data-media-credit-text",""),n.mediaCreditAuthorID=m.getAttrib(l,"data-media-credit-author-id",""),n.mediaCreditLink=m.getAttrib(l,"data-media-credit-link",""),n.mediaCreditNoFollow=m.getAttrib(l,"data-media-credit-nofollow",""));return n}(e),x.$(e).attr("data-wp-editing",1),wp.media.events.trigger("editor:image-edit",{editor:x,metadata:n,image:e}),t=wp.media({frame:"image",state:"image-details",metadata:n}),wp.media.events.trigger("editor:frame-create",{frame:t}),a=function(e){x.undoManager.transact(function(){!function(e,t){var a,n,i,r,d,o,c,l,s,m,p,g,u,h,f,w,v,C,N,_,b,T,A=x.dom;if(!e||!e.length)return;l=e[0],(a=tinymce.explode(t.extraClasses," "))||(a=[]);i=l.parentNode&&"A"===l.parentNode.nodeName&&!P(l.parentNode)?l.parentNode:l;C=A.getNext(i,".mceMediaCreditTemp"),t.caption||(C?A.setAttrib(C,"data-media-credit-align","align"+t.align):a.push("align"+t.align));t.attachment_id&&(a.push("wp-image-"+t.attachment_id),t.size&&"custom"!==t.size&&a.push("size-"+t.size));f=t.width,w=t.height,"custom"===t.size&&(f=t.customWidth,w=t.customHeight);u={src:t.url,width:f||null,height:w||null,title:t.title||null,class:a.join(" ")||null},A.setAttribs(l,u),e.attr("alt",t.alt||""),h={href:t.linkUrl,rel:t.linkRel||null,target:t.linkTargetBlank?"_blank":null,class:t.linkClassName||null},l.parentNode&&"A"===l.parentNode.nodeName&&!P(l.parentNode)?t.linkUrl?A.setAttribs(l.parentNode,h):A.remove(l.parentNode,!0):t.linkUrl&&((c=A.getParent(l,"a"))&&A.insertAfter(l,c),c=A.create("a",h),l.parentNode.insertBefore(c,l),c.appendChild(l));s=x.dom.getParent(l,".mceTemp"),f=parseInt(f,10),x.getParam("wpeditimage_html5_captions")||(f+=10);t.caption?(t.caption=function(e){if(!e||-1===e.indexOf("<")&&-1===e.indexOf(">"))return e;M||(M=new tinymce.html.Serializer({},x.schema));return M.serialize(x.parser.parse(e,{forced_root_block:!1}))}(t.caption),g=t.attachment_id?"attachment_"+t.attachment_id:null,v="align"+(t.align||"none"),n="wp-caption "+v,t.captionClassName&&(n+=" "+t.captionClassName.replace(/[<>&]+/g,"")),C&&A.setAttrib(C,"data-media-credit-align",v),s?((p=A.select("dl.wp-caption",s)).length&&A.setAttribs(p,{id:g,class:n,style:"width: "+f+"px"}),(m=A.select(".wp-caption-dd",s)).length&&A.setHTML(m[0],t.caption)):(r="<dl "+(g=g?'id="'+g+'" ':"")+'class="'+n+'" style="width: '+f+'px"><dt class="wp-caption-dt"></dt><dd class="wp-caption-dd">'+t.caption+"</dd></dl>",o=A.create("div",{class:"mceTemp"},r),(d=A.getParent(i,"p"))||(d=A.getParent(i,".mceMediaCreditOuterTemp"))?(d.parentNode.insertBefore(o,d),A.remove(i),C&&A.remove(C)):i.parentNode.insertBefore(o,i),i=x.$(o).find("dt.wp-caption-dt").append(i),d&&A.isEmpty(d)&&A.remove(d),C&&i.append(C))):(_=!t.mediaCreditText&&!t.mediaCreditAuthorID,s?(C=A.getNext(i,".mceMediaCreditTemp"),d=C&&!_?(v="align"+(t.align||"none"),A.create("div",{class:"mceMediaCreditOuterTemp "+v,style:"width: "+f+"px"})):A.create("p"),s.parentNode.insertBefore(d,s),d.appendChild(i),C&&!_&&d.appendChild(C),A.remove(s)):(N=A.getParent(C,".mceMediaCreditOuterTemp"))&&(_?(d=A.create("p"),N.parentNode.insertBefore(d,N),d.appendChild(i),A.remove(N)):(v="align"+(t.align||"none"),N.className=N.className.replace(/ ?align(left|center|right|none)/g," ")+v,A.setAttrib(N,"style","width: "+f+"px"))),e=x.$(l),b=e.attr("srcset"),T=e.attr("src"),b&&T&&(T=T.replace(/[?#].*/,""),-1===b.indexOf(T)&&e.attr("srcset",null).attr("sizes",null)));wp.media.events&&wp.media.events.trigger("editor:image-update",{editor:x,metadata:t,image:l});x.nodeChanged()}(i,e)}),t.detach()},t.state("image-details").on("update",a),t.state("replace-image").on("replace",a),t.on("close",function(){x.focus(),t.detach(),(i=x.$("img[data-wp-editing]")).removeAttr("data-wp-editing")}),t.open()}(x.selection.getNode())}}),e({alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",alignnone:"No alignment"},function(e,n){var t=n.slice(5);x.addButton("wp_img_"+n,{tooltip:e,icon:"dashicon dashicons-align-"+t,cmd:"alignnone"===n?"wpAlignNone":"Justify"+t.slice(0,1).toUpperCase()+t.slice(1),onPostRender:function(){var a=this;x.on("NodeChange",function(e){var t;"IMG"===e.element.nodeName&&(t=x.dom.getParent(e.element,".wp-caption")||e.element,"alignnone"===n?a.active(!/\balign(left|center|right)\b/.test(t.className)):a.active(x.dom.hasClass(t,n)))})}})}),x.once("preinit",function(){x.wp&&x.wp._createToolbar&&(m=x.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wp_img_edit","wp_img_remove"]))}),x.on("wptoolbar",function(e){"IMG"!==e.element.nodeName||i(e.element)||(e.toolbar=m)}),t&&x.on("init",function(){x.on("touchstart",function(e){"IMG"!==e.target.nodeName||r(e.target)||(a=!0)}),x.dom.bind(x.getDoc(),"touchmove",function(){a=!1}),x.on("touchend",function(e){var t;a&&"IMG"===e.target.nodeName&&!r(e.target)?(t=e.target,a=!1,window.setTimeout(function(){x.selection.select(t),x.nodeChanged()},100)):m&&m.hide()})}),x.on("init",function(){var t=x.dom,e=x.getParam("wpeditimage_html5_captions")?"html5-captions":"html4-captions";t.addClass(x.getBody(),e),tinymce.Env.ie&&10<tinymce.Env.ie&&t.bind(x.getBody(),"mscontrolselect",function(e){"IMG"===e.target.nodeName&&t.getParent(e.target,".wp-caption")?x.getBody().focus():"DL"===e.target.nodeName&&t.hasClass(e.target,"wp-caption")&&e.target.focus()})}),x.on("ObjectResized",function(n){var i=n.target;"IMG"===i.nodeName&&x.undoManager.transact(function(){var e,t,a=x.dom;"IMG"===i.nodeName&&(i.className=i.className.replace(/\bsize-[^ ]+/,""),(e=a.getParent(i,".wp-caption"))&&(t=n.width||a.getAttrib(i,"width"))&&(t=parseInt(t,10),x.getParam("wpeditimage_html5_captions")||(t+=10),a.setStyle(e,"width",t+"px")))})}),x.on("pastePostProcess",function(e){x.dom.getParent(x.selection.getNode(),"dd.wp-caption-dd")&&(x.$("img, audio, video, object, embed, iframe, script, style",e.node).remove(),x.$("*",e.node).each(function(e,t){x.dom.isBlock(t)&&(tinymce.trim(t.textContent||t.innerText)?(x.dom.insertAfter(x.dom.create("br"),t),x.dom.remove(t,!0)):x.dom.remove(t))}),x.$("br",e.node).each(function(e,t){t.nextSibling&&"BR"!==t.nextSibling.nodeName&&t.previousSibling&&"BR"!==t.previousSibling.nodeName||x.dom.remove(t)}),p=!0)}),x.on("BeforeExecCommand",function(e){var t,a,n,i,r,d,o,c,l=e.command,s=x.dom;if("mceInsertContent"===l||"Indent"===l||"Outdent"===l){if(t=x.selection.getNode(),d=s.getParent(t,"div.mceTemp")||s.getParent(t,"div.mceMediaCreditOuterTemp")){if("mceInsertContent"!==l)return e.preventDefault(),e.stopImmediatePropagation(),!1;if(p)return void(p=!1);a=s.create("p"),s.insertAfter(a,d),x.selection.setCursorLocation(a,0),"IMG"===t.nodeName&&x.$(d).remove(),x.nodeChanged()}}else if("JustifyLeft"===l||"JustifyRight"===l||"JustifyCenter"===l||"wpAlignNone"===l){if(t=x.selection.getNode(),i="align"+l.slice(7).toLowerCase(),n=x.dom.getParent(t,".wp-caption"),"IMG"!==t.nodeName&&!n)return;t=n||t,o=s.getNext(s.getParent(t,"a"),".mceMediaCreditTemp")||s.select(".mceMediaCreditTemp",t),r=x.dom.hasClass(t,i)?" alignnone":" "+i,t.className=g(t.className.replace(/ ?align(left|center|right|none)/g,"")+r),o&&(s.setAttrib(o,"data-media-credit-align",i),(c=s.getParent(o,"div.mceMediaCreditOuterTemp"))&&(c.className=g(c.className.replace(/ ?align(left|center|right|none)/g,"")+r))),x.nodeChanged(),e.preventDefault(),m&&m.reposition(),x.fire("ExecCommand",{command:l,ui:e.ui,value:e.value})}}),x.on("keydown",function(e){var t,a,n,i,r=x.selection,d=e.keyCode,o=x.dom,c=tinymce.util.VK;if(d===c.ENTER)t=r.getNode(),(a=o.getParent(t,"div.mceTemp"))||(a=o.getParent(t,"div.mceMediaCreditOuterTemp")),a&&(o.events.cancel(e),tinymce.each(o.select("dt, dd",a),function(e){o.isEmpty(e)&&o.remove(e)}),i=tinymce.Env.ie&&tinymce.Env.ie<11?"":'<br data-mce-bogus="1" />',n=o.create("p",null,i),"DD"===t.nodeName?o.insertAfter(n,a):a.parentNode.insertBefore(n,a),x.nodeChanged(),r.setCursorLocation(n,0));else if((d===c.DELETE||d===c.BACKSPACE)&&("DIV"===(t=r.getNode()).nodeName&&(o.hasClass(t,"mceTemp")||o.hasClass(t,"mceMediaCreditOuterTemp"))?a=t:"IMG"!==t.nodeName&&"DT"!==t.nodeName&&"A"!==t.nodeName||(a=o.getParent(t,"div.mceTemp")||o.getParent(t,"div.mceMediaCreditOuterTemp")),a))return o.events.cancel(e),s(t),!1}),x.on("NodeChange",function(e){var t,a,n="",i=!1,r=e.element,d=x.dom;if(t=d.getParent(r,"div.mceTemp")||d.getParent(r,"div.mceMediaCreditOuterTemp"))return"A"===r.nodeName&&0===r.children.length?(n=r.textContent,i=!0):"DIV"===r.nodeName&&d.hasClass(r,"mceMediaCreditOuterTemp")&&1===r.children.length&&d.hasClass(r.firstElementChild,"mceMediaCreditTemp")&&(n=r.firstChild.textContent,i=!0),i?(a=d.create("p",null,n),d.insertAfter(a,t),d.events.cancel(e),d.remove(t),!1):void 0}),tinymce.Env.gecko&&x.on("undo redo",function(){"IMG"===x.selection.getNode().nodeName&&x.selection.collapse()}),x.wpSetImgCaption=function(e){return d(e)},x.wpGetImgCaption=function(e){return o(e)},x.on("beforeGetContent",function(e){"raw"!==e.format&&x.$('img[id="__wp-temp-img-id"]').removeAttr("id")}),x.on("BeforeSetContent",function(e){"raw"!==e.format&&(e.content=x.wpSetImgCaption(e.content))}),x.on("PostProcess",function(e){e.get&&(e.content=x.wpGetImgCaption(e.content))}),x.on("dragstart",function(){var e=x.selection.getNode();"IMG"===e.nodeName&&((n=x.dom.getParent(e,".mceTemp"))||"A"!==e.parentNode.nodeName||P(e.parentNode)||(n=e.parentNode))}),x.on("drop",function(e){var t=x.dom,a=tinymce.dom.RangeUtils.getCaretRangeFromPoint(e.clientX,e.clientY,x.getDoc());a&&t.getParent(a.startContainer,".mceTemp")?e.preventDefault():n&&(e.preventDefault(),x.undoManager.transact(function(){a&&x.selection.setRng(a),x.selection.setNode(n),t.remove(n)})),n=null}),x.wp=x.wp||{},x.wp.isPlaceholder=i,{_do_shcode:d,_get_shcode:o}},["noneditable"]);